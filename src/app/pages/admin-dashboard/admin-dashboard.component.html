<!-- HEADER ADMIN -->
<div class="bg-white border-bottom">
  <div class="container-fluid">
    <div class="row align-items-center py-3">
      <div class="col-md-6">
        <h1 class="mb-0 fw-bold text-primary">Dashboard Administrateur</h1>
      </div>
      <div class="col-md-6 text-end">
        <button class="btn btn-outline-primary me-2" (click)="refreshData()">
          <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i> Actualiser
        </button>
         <button class="btn btn-outline-danger">
          <i class="fas fa-sign-out-alt" (click)="logout()"></i> Déconnexion
        </button>
      </div>
    </div>
  </div>
</div>

<!-- NAVIGATION SIDEBAR -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-2 bg-white border-end p-0">
      <div class="nav flex-column p-3" style="min-height: calc(100vh - 80px)">
        <button 
          class="nav-link-custom text-start mb-2" 
          [class.active]="currentSection === 'overview'"
          (click)="setCurrentSection('overview')"
        >
          <i class="fas fa-chart-line me-2"></i>
          Vue d'ensemble
        </button>
        <button 
          class="nav-link-custom text-start mb-2" 
          (click)="goToReservations()"
        >
          <i class="fas fa-calendar-alt me-2"></i>
          Réservations
        </button>
        <button 
          class="nav-link-custom text-start mb-2" 
          (click)="goToUser()"
        >
          <i class="fas fa-users me-2"></i>
          Clients
        </button>
       <button 
          class="nav-link-custom text-start mb-2" 
          (click)="goToDestinations()"
        >
          <i class="fas fa-map-marked-alt me-2"></i>
          Destinations
        </button>
        <button 
          class="nav-link-custom text-start mb-2" 
          [class.active]="currentSection === 'settings'"
          (click)="setCurrentSection('settings')"
        >
          <i class="fas fa-cog me-2"></i>
          Paramètres
        </button>
      </div>
    </div>

    <div class="col-md-10 p-4" style="background-color: #f8fafc;">

      <!-- LOADING SPINNER -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Chargement...</span>
        </div>
        <p class="text-muted mt-3">Chargement des statistiques...</p>
      </div>

      <!-- VUE D'ENSEMBLE -->
      <div *ngIf="currentSection === 'overview' && !isLoading">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="fw-bold mb-4">Statistiques Générales</h2>
          </div>
        </div>

        <!-- CARDS STATISTIQUES PRINCIPALES -->
        <div class="row g-4 mb-5">
          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm stat-card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="text-muted mb-2 text-uppercase fw-semibold" style="font-size: 0.75rem; letter-spacing: 0.5px;">
                      Total Réservations
                    </p>
                    <h3 class="mb-1 fw-bold text-primary" style="font-size: 2rem;">
                      {{dashboardStats.totalBookings | number}}
                    </h3>
                    
                  </div>
                  <div class="text-primary opacity-75">
                    <i class="fas fa-calendar-check fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm stat-card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="text-muted mb-2 text-uppercase fw-semibold" style="font-size: 0.75rem; letter-spacing: 0.5px;">
                      Chiffre d'Affaires
                    </p>
                    <h3 class="mb-1 fw-bold text-success" style="font-size: 2rem;">
                      {{dashboardStats.totalRevenue}}
                    </h3>
                    
                  </div>
                  <div class="text-success opacity-75">
                   
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm stat-card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="text-muted mb-2 text-uppercase fw-semibold" style="font-size: 0.75rem; letter-spacing: 0.5px;">
                      Clients Actifs
                    </p>
                    <h3 class="mb-1 fw-bold text-info" style="font-size: 2rem;">
                      {{dashboardStats.activeCustomers | number}}
                    </h3>
                    <small class="text-muted">
                      Sur {{users.length}} inscrits
                    </small>
                  </div>
                  <div class="text-info opacity-75">
                    <i class="fas fa-users fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm stat-card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="text-muted mb-2 text-uppercase fw-semibold" style="font-size: 0.75rem; letter-spacing: 0.5px;">
                      Destinations
                    </p>
                    <h3 class="mb-1 fw-bold text-warning" style="font-size: 2rem;">
                      {{dashboardStats.totalDestinations | number}}
                    </h3>
                    <small class="text-muted">
                      Disponibles
                    </small>
                  </div>
                  <div class="text-warning opacity-75">
                    <i class="fas fa-map-marked-alt fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CARDS STATISTIQUES SECONDAIRES -->
        <div class="row g-4 mb-5">
          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body text-center">
                <div class="mb-3">
                  <i class="fas fa-star text-warning fa-2x"></i>
                </div>
                <h4 class="fw-bold text-warning">{{dashboardStats.averageRating}}/5</h4>
                <p class="text-muted mb-0">Note moyenne</p>
                <small class="text-muted">{{dashboardStats.totalReviews}} avis</small>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body text-center">
                <div class="mb-3">
                  <i class="fas fa-clock text-orange fa-2x"></i>
                </div>
                <h4 class="fw-bold text-orange">{{dashboardStats.pendingBookings}}</h4>
                <p class="text-muted mb-0">En attente</p>
                <small class="text-muted">Réservations</small>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body text-center">
                <div class="mb-3">
                  <i class="fas fa-check-circle text-success fa-2x"></i>
                </div>
                <h4 class="fw-bold text-success">{{dashboardStats.completedBookings}}</h4>
                <p class="text-muted mb-0">Confirmées</p>
                <small class="text-muted">Réservations</small>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body text-center">
                <div class="mb-3">
                  <i class="fas fa-percentage text-purple fa-2x"></i>
                </div>
                <h4 class="fw-bold text-purple">
                  {{getProgressPercentage(dashboardStats.completedBookings, dashboardStats.totalBookings)}}%
                </h4>
                <p class="text-muted mb-0">Taux de confirmation</p>
              </div>
            </div>
          </div>
        </div>

        <!-- DESTINATIONS POPULAIRES -->
        <div class="row mb-5">
          <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-trophy text-warning me-2"></i>
                  Destinations Populaires
                </h5>
              </div>
              <div class="card-body">
                <div *ngIf="popularDestinations.length === 0" class="text-center text-muted py-4">
                  <i class="fas fa-map-marked-alt fa-3x mb-3 opacity-50"></i>
                  <p>Aucune destination populaire pour le moment</p>
                </div>
                <div *ngFor="let destination of popularDestinations; let i = index" class="d-flex align-items-center mb-3">
                  <div class="badge bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">
                    {{i + 1}}
                  </div>
                  <div class="flex-grow-1">
                    <div class="fw-semibold">{{destination.nom}}</div>
                    <small class="text-muted">{{destination.bookingsCount}} réservations • {{destination.revenue | number}} FCFA</small>
                  </div>
                  <div class="text-end">
                    <div class="progress" style="width: 60px; height: 8px;">
                      <div class="progress-bar bg-primary" 
                           [style.width.%]="getProgressPercentage(destination.bookingsCount, popularDestinations[0]?.bookingsCount || 1)">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RÉSERVATIONS RÉCENTES -->
          <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-clock text-info me-2"></i>
                  Réservations Récentes
                </h5>
              </div>
              <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div *ngIf="recentBookings.length === 0" class="text-center text-muted py-4">
                  <i class="fas fa-calendar-times fa-3x mb-3 opacity-50"></i>
                  <p>Aucune réservation récente</p>
                </div>
                <div *ngFor="let booking of recentBookings" class="d-flex align-items-center mb-3 pb-3 border-bottom">
                  <div class="me-3">
                    <div class="badge rounded-pill" [ngClass]="getStatusBadgeClass(booking.statut)">
                      <i class="fas fa-circle" style="font-size: 0.5rem;"></i>
                    </div>
                  </div>
                  <div class="flex-grow-1">
                    <div class="fw-semibold">{{booking.clientName}}</div>
                    <div class="text-muted small">{{booking.destination}}</div>
                    <div class="text-muted small">{{formatDate(booking.dateReservation)}}</div>
                  </div>
                  <div class="text-end">
                    <div class="fw-bold">{{booking.montant | number}} FCFA</div>
                    <small class="badge rounded-pill" [ngClass]="getStatusBadgeClass(booking.statut)">
                      {{getStatusText(booking.statut)}}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- MÉTHODES DE PAIEMENT -->
        <div class="row mb-5" *ngIf="paymentMethods.length > 0">
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-credit-card text-success me-2"></i>
                  Répartition des Méthodes de Paiement
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div *ngFor="let method of paymentMethods" class="col-md-4 mb-3">
                    <div class="text-center">
                      <div class="mb-3">
                        <i class="fas" 
                           [class.fa-credit-card]="method.method === 'stripe'"
                           [class.fa-mobile-alt]="method.method === 'wave'"
                           [class.fa-money-bill-wave]="method.method !== 'stripe' && method.method !== 'wave'"
                           class="fa-2x text-success"></i>
                      </div>
                      <h5 class="fw-bold text-capitalize">{{method.method}}</h5>
                      <p class="text-muted mb-1">{{method.count}} paiements</p>
                      <p class="fw-bold">{{method.total | number}} €</p>
                      <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-success" [style.width.%]="method.percentage"></div>
                      </div>
                      <small class="text-muted">{{method.percentage}}%</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ÉVOLUTION MENSUELLE -->
        <div class="row" *ngIf="monthlyStats.length > 0">
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-chart-line text-primary me-2"></i>
                  Évolution des 6 Derniers Mois
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-borderless">
                    <thead>
                      <tr class="border-bottom">
                        <th class="fw-semibold">Mois</th>
                        <th class="text-center fw-semibold">Réservations</th>
                        <th class="text-center fw-semibold">Revenus</th>
                        <th class="text-center fw-semibold">Progression</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let stat of monthlyStats; let i = index">
                        <td class="fw-semibold">{{stat.month}}</td>
                        <td class="text-center">
                          <span class="badge bg-primary rounded-pill">{{stat.bookings}}</span>
                        </td>
                        <td class="text-center fw-bold">{{stat.revenue | number}} FCFA</td>
                        <td class="text-center">
                          <div class="progress" style="height: 20px; width: 100px; margin: 0 auto;">
                            <div class="progress-bar bg-gradient" 
                                 [style.width.%]="getProgressPercentage(stat.bookings, getMaxBookings())"
                                 [class.bg-success]="i === monthlyStats.length - 1"
                                 [class.bg-info]="i !== monthlyStats.length - 1">
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PARAMÈTRES -->
      <div *ngIf="currentSection === 'settings'">
        <div class="row mb-4">
          <div class="col-12">
            <h2 class="fw-bold">Paramètres du Système</h2>
          </div>
        </div>

        <div class="row g-4">
          <!-- Paramètres généraux -->
          <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-cog me-2"></i>
                  Paramètres Généraux
                </h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label fw-semibold">Nom du site</label>
                  <input type="text" class="form-control" value="Voyage Intelligent">
                </div>
                <div class="mb-3">
                  <label class="form-label fw-semibold">Email de contact</label>
                  <input type="email" class="form-control" value="admin@voyage-intelligent.com">
                </div>
                <div class="mb-3">
                  <label class="form-label fw-semibold">Devise par défaut</label>
                  <select class="form-select">
                    <option value="EUR" selected>Euro (€)</option>
                    <option value="USD">Dollar ($)</option>
                    <option value="GBP">Livre (£)</option>
                  </select>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="maintenance" checked>
                  <label class="form-check-label fw-semibold" for="maintenance">
                    Site en maintenance
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Notifications -->
          <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-bell me-2"></i>
                  Notifications
                </h5>
              </div>
              <div class="card-body">
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="emailBooking" checked>
                  <label class="form-check-label" for="emailBooking">
                    Email pour nouvelles réservations
                  </label>
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="emailCancel" checked>
                  <label class="form-check-label" for="emailCancel">
                    Email pour annulations
                  </label>
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="smsNotif">
                  <label class="form-check-label" for="smsNotif">
                    Notifications SMS
                  </label>
                </div>
                <div class="mb-3">
                  <label class="form-label fw-semibold">Fréquence des rapports</label>
                  <select class="form-select">
                    <option value="daily">Quotidien</option>
                    <option value="weekly" selected>Hebdomadaire</option>
                    <option value="monthly">Mensuel</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Sécurité -->
          <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-shield-alt me-2"></i>
                  Sécurité
                </h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label fw-semibold">Tentatives de connexion max</label>
                  <input type="number" class="form-control" value="5">
                </div>
                <div class="mb-3">
                  <label class="form-label fw-semibold">Durée de session (minutes)</label>
                  <input type="number" class="form-control" value="120">
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="2fa" checked>
                  <label class="form-check-label" for="2fa">
                    Authentification à 2 facteurs
                  </label>
                </div>
                <button class="btn btn-warning">
                  <i class="fas fa-key me-2"></i>
                  Changer mot de passe
                </button>
              </div>
            </div>
          </div>

          <!-- Sauvegarde -->
          <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-database me-2"></i>
                  Sauvegarde
                </h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <p class="text-muted">Dernière sauvegarde: 06/08/2025 à 14:30</p>
                </div>
                <div class="mb-3">
                  <label class="form-label fw-semibold">Sauvegarde automatique</label>
                  <select class="form-select">
                    <option value="daily" selected>Quotidienne</option>
                    <option value="weekly">Hebdomadaire</option>
                    <option value="manual">Manuelle uniquement</option>
                  </select>
                </div>
                <div class="d-grid gap-2">
                  <button class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>
                    Sauvegarder maintenant
                  </button>
                  <button class="btn btn-outline-secondary">
                    <i class="fas fa-upload me-2"></i>
                    Restaurer sauvegarde
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions système -->
        <div class="row mt-4">
          <div class="col-12">
            <div class="card border-0 shadow-sm border-danger">
              <div class="card-header bg-danger text-white border-bottom">
                <h5 class="mb-0 fw-bold">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  Zone Dangereuse
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-4">
                    <button class="btn btn-outline-warning w-100 mb-2">
                      <i class="fas fa-broom me-2"></i>
                      Vider le cache
                    </button>
                  </div>
                  <div class="col-md-4">
                    <button class="btn btn-outline-danger w-100 mb-2">
                      <i class="fas fa-chart-bar me-2"></i>
                      Réinitialiser statistiques
                    </button>
                  </div>
                  <div class="col-md-4">
                    <button class="btn btn-outline-dark w-100 mb-2">
                      <i class="fas fa-redo me-2"></i>
                      Redémarrer système
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bouton sauvegarder -->
        <div class="row mt-4">
          <div class="col-12 text-center">
            <button class="btn btn-success btn-lg px-5">
              <i class="fas fa-save me-2"></i>
              Sauvegarder tous les paramètres
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- CSS personnalisé pour le style -->
<style>
.nav-link-custom {
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  padding: 0.75rem 1.5rem;
  color: #64748b;
  transition: all 0.2s ease;
  border-radius: 6px;
  font-weight: 500;
}

.nav-link-custom:hover {
  background-color: #f1f5f9;
  color: #2563eb;
}

.nav-link-custom.active {
  background-color: #2563eb;
  color: white;
}

.stat-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.progress {
  background-color: #f8f9fa;
}

.badge {
  font-size: 0.8rem;
}

.card {
  border: none !important;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
}

.card-header {
  background-color: #ffffff !important;
  border-bottom: 1px solid #e5e7eb !important;
}

.text-purple {
  color: #6f42c1 !important;
}

.text-orange {
  color: #fd7e14 !important;
}

.opacity-50 {
  opacity: 0.5;
}
</style>