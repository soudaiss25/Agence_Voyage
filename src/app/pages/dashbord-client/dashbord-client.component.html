<!-- dashboard-client.component.html -->
<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header shadow-sm mb-4" style="background: linear-gradient(135deg, #0d6efd 0%, #6f42c1 100%);">
    <div class="container-fluid">
      <div class="row align-items-center py-3">
        <div class="col-md-6">
          <h2 class="mb-0 text-white">
            <i class="fas fa-plane me-2"></i>
            Mon Espace Voyage
          </h2>
        </div>
        <div class="col-md-6 text-end">
          <div class="dropdown">
            <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
              <i class="fas fa-user me-1"></i>
              Bonjour, {{ utilisateur?.prenom || 'Voyageur' }}
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#profil"><i class="fas fa-user me-2"></i>Mon Profil</a></li>
              <li><a class="dropdown-item" href="#parametres"><i class="fas fa-cog me-2"></i>Paramètres</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" (click)="authService.logout()"><i class="fas fa-sign-out-alt me-2"></i>Déconnexion</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Loader -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-3 text-muted">Chargement de votre espace voyage...</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger d-flex justify-content-between align-items-center" role="alert">
    <span>
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ errorMessage }}
    </span>
    <button class="btn btn-outline-danger btn-sm" (click)="retry()">
      <i class="fas fa-redo me-1"></i>Réessayer
    </button>
  </div>

  <div class="container-fluid" *ngIf="!isLoading && !errorMessage">
    <!-- Statistiques rapides -->
    <div class="row mb-4">
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #0d6efd, #4285f4); color: white;">
          <div class="card-body text-center">
            <div class="mb-2">
              <i class="fas fa-route fs-1"></i>
            </div>
            <div class="stat-number fs-2 fw-bold">{{ nombreVoyages }}</div>
            <div class="stat-label opacity-75">Voyages réalisés</div>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #20c997, #40e0d0); color: white;">
          <div class="card-body text-center">
            <div class="mb-2">
              <i class="fas fa-calendar-alt fs-1"></i>
            </div>
            <div class="stat-number fs-2 fw-bold">{{ voyagesAVenir }}</div>
            <div class="stat-label opacity-75">Voyages à venir</div>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #fd7e14, #ffb347); color: white;">
          <div class="card-body text-center">
            <div class="mb-2">
              <i class="fas fa-star fs-1"></i>
            </div>
            <div class="stat-number fs-2 fw-bold">{{ recommendations }}</div>
            <div class="stat-label opacity-75">Recommandations</div>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #6f42c1, #9d4edd); color: white;">
          <div class="card-body text-center">
            <div class="mb-2">
              <i class="fas fa-globe-americas fs-1"></i>
            </div>
            <div class="stat-number fs-2 fw-bold">{{ paysVisites }}</div>
            <div class="stat-label opacity-75">Pays visités</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contenu principal -->
    <div class="row">
      <!-- Voyages à venir -->
      <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0" style="color: #0d6efd;">
                <i class="fas fa-plane-departure me-2"></i>
                Mes prochains voyages
              </h5>
              <button class="btn btn-sm btn-outline-primary" (click)="voirTousLesVoyages()">Voir tout</button>
            </div>
          </div>
          <div class="card-body">
            <!-- Voyages à venir - données réelles -->
            <div class="voyage-item border-bottom pb-3 mb-3" *ngFor="let voyage of prochainsVoyages.slice(0, 3); let last = last" [class.border-bottom]="!last">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h6 class="mb-1 fw-bold" style="color: #0d6efd;">
                    <i class="fas fa-map-marker-alt me-1"></i>
                    {{ voyage.destination?.nom || 'Destination inconnue' }}
                    <span *ngIf="voyage.destination?.pays" class="text-muted small">, {{ voyage.destination?.pays }}</span>
                  </h6>
                  <p class="text-muted mb-1">
                    <i class="fas fa-calendar me-1"></i>
                    {{ formatDateRange(voyage.dateDepart, voyage.dateRetour) }}
                  </p>
                  <div class="d-flex align-items-center">
                    <small class="badge me-2" [ngClass]="getStatutBadgeClass(voyage.statut)">
                      <i class="fas fa-check me-1" *ngIf="voyage.statut === 'confirme'"></i>
                      <i class="fas fa-clock me-1" *ngIf="voyage.statut === 'en_attente'"></i>
                      {{ getStatutText(voyage.statut) }}
                    </small>
                    <small class="text-muted">
                      <i class="fas fa-users me-1"></i>{{ voyage.nombrePlaceReservee }} personne(s)
                    </small>
                  </div>
                </div>
                <div class="col-md-4 text-end">
                  <div class="mb-2">
                    <strong class="text-success">{{ getPrixFormate(voyage.prixTotal) }}</strong>
                  </div>
                  <button class="btn btn-sm btn-outline-info me-2" (click)="voirDetailsVoyage(voyage.id!)">Détails</button>
                  <button class="btn btn-sm text-white" style="background: linear-gradient(135deg, #0d6efd, #6f42c1);" (click)="gererVoyage(voyage.id!)">Gérer</button>
                </div>
              </div>
            </div>

            <!-- Message si aucun voyage -->
            <div class="text-center py-4" *ngIf="prochainsVoyages.length === 0">
              <div class="text-muted mb-3">
                <div class="fs-1 mb-2">✈️</div>
                <p>Aucun voyage prévu pour le moment</p>
              </div>
              <button class="btn text-white fw-bold" style="background: linear-gradient(135deg, #0d6efd, #6f42c1);" (click)="planifierVoyage()">
                <i class="fas fa-plus me-2"></i>
                Planifier un voyage
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Recommandations -->
      <div class="col-lg-4 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0" style="color: #0d6efd;">
                <i class="fas fa-magic me-2"></i>
                Recommandations
              </h5>
              <button class="btn btn-sm btn-outline-primary" (click)="voirToutesRecommandations()">Toutes</button>
            </div>
          </div>
          <div class="card-body">
            <!-- Recommandations réelles -->
            <div class="recommendation-item mb-3" *ngFor="let recommendation of recommandationsActuelles; let i = index">
              <div class="recommendation-card p-3 border-2 rounded" 
                   [style.border-color]="i === 0 ? '#20c997' : (i === 1 ? '#fd7e14' : '#6f42c1')" 
                   [style.background]="i === 0 ? 'linear-gradient(135deg, rgba(32, 201, 151, 0.1), rgba(64, 224, 208, 0.1))' : 
                                     (i === 1 ? 'linear-gradient(135deg, rgba(253, 126, 20, 0.1), rgba(255, 179, 71, 0.1))' : 
                                     'linear-gradient(135deg, rgba(111, 66, 193, 0.1), rgba(157, 78, 221, 0.1))')">
                <h6 class="fw-bold mb-2" style="color: #0d6efd;">
                  <i class="fas fa-map-marker-alt me-1"></i>
                  {{ recommendation.destination?.nom || 'Destination' }}
                  <span *ngIf="recommendation.destination?.pays" class="small text-muted">, {{ recommendation.destination?.pays }}</span>
                </h6>
                <ng-container *ngIf="recommendation.destination?.description as desc">
  <p class="text-muted small mb-2">
    {{ desc | slice:0:80 }}{{ desc.length > 80 ? '...' : '' }}
  </p>
</ng-container>

                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-bold" 
      [style.color]="i === 0 ? '#20c997' : (i === 1 ? '#fd7e14' : '#6f42c1')" 
      *ngIf="recommendation.destination?.prix !== undefined">
  À partir de {{ getPrixFormate(recommendation.destination?.prix) }}
</span>
                  <span class="text-muted small" *ngIf="!recommendation.destination?.prix">Prix sur demande</span>
                  <button class="btn btn-sm text-white" 
                          [style.background]="i === 0 ? 'linear-gradient(135deg, #20c997, #40e0d0)' : 
                                            (i === 1 ? 'linear-gradient(135deg, #fd7e14, #ffb347)' : 
                                            'linear-gradient(135deg, #6f42c1, #9d4edd)')"
                          (click)="voirRecommandation(recommendation.id!)">Voir</button>
                </div>
              </div>
            </div>

            <!-- Bouton pour obtenir des recommandations -->
            <div class="text-center" *ngIf="recommandationsActuelles.length === 0">
              <div class="text-muted mb-3">
                <div class="fs-3 mb-2">🎯</div>
                <p>Aucune recommandation pour le moment</p>
              </div>
              <button class="btn w-100 text-white fw-bold" style="background: linear-gradient(135deg, #0d6efd, #6f42c1);" (click)="obtenirRecommandations()">
                <i class="fas fa-wand-magic-sparkles me-2"></i>
                Obtenir des recommandations
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Historique des voyages -->
    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0" style="color: #0d6efd;">
                <i class="fas fa-book me-2"></i>
                Historique des voyages
              </h5>
              <button class="btn btn-sm btn-outline-primary" (click)="voirTousLesVoyages()">Voir tout</button>
            </div>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Voyages passés - données réelles -->
              <div class="col-md-4 mb-3" *ngFor="let voyage of historiqueVoyages.slice(0, 6); let i = index">
                <div class="voyage-history-card p-3 border-2 rounded" 
                     [style.border-color]="i % 3 === 0 ? '#6f42c1' : (i % 3 === 1 ? '#20c997' : '#fd7e14')"
                     [style.background]="i % 3 === 0 ? 'linear-gradient(135deg, rgba(111, 66, 193, 0.1), rgba(157, 78, 221, 0.1))' : 
                                       (i % 3 === 1 ? 'linear-gradient(135deg, rgba(32, 201, 151, 0.1), rgba(64, 224, 208, 0.1))' : 
                                       'linear-gradient(135deg, rgba(253, 126, 20, 0.1), rgba(255, 179, 71, 0.1))')">
                  <h6 class="fw-bold mb-2" style="color: #0d6efd;">
                    <i class="fas fa-map-marker-alt me-1"></i>
                    {{ voyage.destination?.nom || 'Destination inconnue' }}
                    <span *ngIf="voyage.destination?.pays" class="small text-muted">, {{ voyage.destination?.pays }}</span>
                  </h6>
                  <p class="text-muted small mb-2">
                    <i class="fas fa-calendar me-1"></i>
                    {{ formatDateRange(voyage.dateDepart, voyage.dateRetour) }}
                  </p>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-success">
                      <i class="fas fa-check me-1"></i>
                      {{ getStatutText(voyage.statut) }}
                    </span>
                    <div>
                      <small class="text-muted me-2">{{ getPrixFormate(voyage.prixTotal) }}</small>
                      <button class="btn btn-sm btn-outline-primary" (click)="voirDetailsVoyage(voyage.id!)">Revoir</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Message si aucun historique -->
            <div class="text-center py-4" *ngIf="historiqueVoyages.length === 0">
              <div class="text-muted">
                <div class="fs-1 mb-2">📚</div>
                <p>Votre historique de voyages apparaîtra ici</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CSS personnalisé à ajouter dans dashboard-client.component.css -->
<style>
  .card {
    transition: transform 0.2s ease-in-out;
  }
  
  .card:hover {
    transform: translateY(-5px);
  }
  
  .btn {
    transition: all 0.3s ease;
  }
  
  .voyage-item:hover,
  .recommendation-card:hover,
  .voyage-history-card:hover {
    transform: translateX(5px);
    transition: transform 0.2s ease;
  }
  
  .stat-number {
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .spinner-border {
    width: 3rem;
    height: 3rem;
  }

  .dashboard-container {
    min-height: 100vh;
    background-color: #f8f9fa;
  }

  .voyage-item:last-child {
    border-bottom: none !important;
    padding-bottom: 0 !important;
    margin-bottom: 0 !important;
  }
</style>